# Android Samples for Advanced Applications of Agora Video SDK APIs

*English | [中文](README.zh.md)*

## Modules

### Customized Video Sources and Video Rendering

MediaIO is a set of interfaces which developers can use to feed video frames to Agora SDK when there's video sources other than system default ones (external video device, capture module, etc) needed. Using this will require developers to maintain the whole capture/rendering life cycles themselves.

This sample has provided two examples using different external video inputs (screenshare and media files), to demonstrate ways to switch, capture and rendering video in your own project. Developers may choose the way that best fits to his scenario.

Developers may refer to [this page](https://docs.agora.io/en/Video/custom_video_android?platform=Android) for further details of MediaIO Apis.

In real world there are different video frame formats like i420, NV21, texture etc. In this sample we used texture to capture/render video. It also shows how to maintain an OpenGL context in your project.

The way how we manages OpenGL context is inspired by [grafika](https://github.com/google/grafika), please go to corresponding project page if you have interest to know more.

In the description text and source code mentioned below, we use term `source` to refer to any external source in MediaIO (which is different from Agora SDK's capture module); while we use `video input` to refer to non MediaIO source such as Camera/Screen Share/Media files. 

#### Screen Share

Screen Share is a feature introduced in Android 5.0. Therefore the `min sdk level` of your project shall not be lower than 21.

In most use cases screen share feature may need to stay running in background. To prevent from being killed by system, developers need to put it running in a Foreground service. Note developers are required to register notifications to system for Foreground Service in order to know its running status.

#### Local Videos

This project **does not** provide a .mp4 file by default, developers need to provide one and put it in correct application path. 

We use [MediaExtractor](https://developer.android.com/reference/android/media/MediaExtractor) to extract ByteBuffer from static media files. The extracted ByteBuffer will be sent to [MediaCodec](ttps://developer.android.com/reference/android/media/MediaCodec) with certain interval (e.g. frame playback timestamp). The decoded result is rendered to a pre-configured Surface (generated by texture), for rendering or further processing.

#### Switching between different video inputs

This project has created an abstract layer called `video input` to process video frames from external approach. The layer will ultimately generate a texture, while the video input can be switched at any time w/o letting Agora SDK know.

There is also an OpenGL session maintained in this project's foreground service, in which it processes/send/render the texture. In this way we have an OpenGL context which is easy to maintain.

### Audio & Video Customized Packet Encryption Using Raw-data Plugin Interface

Refer to [Raw Audio Data](https://docs.agora.io/en/Video/raw_data_audio_android?platform=Android) and [Raw Video Data](https://docs.agora.io/en/Video/raw_data_video_android?platform=Android) for how to use audio & video raw data features. 

Packet encryption is one of the common use case of using audio & video raw data interface. Developers can choose to perform any transformation of raw data on the sending side, and do the inverse to recover data on the receiving side.

Note that this project only provides C++ raw data interface. There are also Java layer interfaces before, but the video interfaces have been removed from earlier SDK releases for performance concerns. The Java audio interfaces are still usable, but C++ interfaces are recommended for the same reason.

The App's compiled library name should start with a pre-defined prefix like **"libapm-xxx.so"**, RTC engine will search in the library directory .so files of names of this form as Agora plugins and load the libraries during the plugin manager initialization phase.

Plugins use header files which are in the SDK downloaded zip files but not a part of JCenter dependency. The headers are submitted along with the project right now, but developers will need to upgrade the header files if SDK dependencies are upgraded.


## Prerequisites

- Android Studio 3.3 or above
- Android device (e.g. Nexus 5X). A real device is recommended because some simulators have missing functionality or lack the performance necessary to run the sample.

## Quick Start

This section shows you how to prepare, build, and run the sample application.

### Obtain an App ID

To build and run the sample application, get an App ID:
1. Create a developer account at [agora.io](https://dashboard.agora.io/signin/). Once you finish the signup process, you will be redirected to the Dashboard.
2. Navigate in the Dashboard tree on the left to **Projects** > **Project List**.
3. Save the **App ID** from the Dashboard for later use.
4. Generate a temp **Access Token** (valid for 24 hours) from dashboard page with given channel name, save for later use.

5. Locate the file **lib-component/src/main/res/values/strings_config.xml** and replace <#YOUR APP ID#> with the App ID in the dashboard.

  ```xml
  <string name="agora_app_id"><#YOUR APP ID#></string>
  <!-- Obtain a temp Access Token at https://dashboard.agora.io -->
  <!-- You will need to deploy your own token server for production release -->
  <!-- Leave this value empty if Security keys/Token is not enabled for your project -->
  <string name="agora_access_token"><#YOUR TOKEN#></string>
  ```

### Integrate the Agora Video SDK

The SDK must be integrated into the sample project before it can opened and built. There are two methods for integrating the Agora Video SDK into the sample project. The first method uses JCenter to automatically integrate the SDK files. The second method requires you to manually copy the SDK files to the project.

#### Method 1 - Integrate the SDK Automatically Using JCenter (Recommended)

1. Clone this repository.
2. Open **lib-component/build.gradle** and add the following line to the `dependencies` list:

  ```
  ...
  dependencies {
      ...
      implementation 'io.agora.rtc:full-sdk:3.0.0'
  }
  ```

#### Method 2 - Manually copy the SDK files

1. Download the Agora Video SDK from [Agora.io SDK](https://www.agora.io/en/download/).
2. Unzip the downloaded SDK package.
3. Copy the following files from from the **libs** folder of the downloaded SDK package:

Copy from SDK|Copy to Project Folder
---|---
.jar file|**/lib-component/libs** folder
**arm64-v8a** folder|**/lib-component/src/main/jniLibs** folder
**x86** folder|**/lib-component/src/main/jniLibs** folder
**armeabi-v7a** folder|**/lib-component/src/main/jniLibs** folder

    

### Run the Application

Open project with Android Studio, connect your Android device, build and run.
      
Or use `Gradle` to build and run.


## Contract Us

- For potential issues, take a look at our [FAQ](https://docs.agora.io/cn/faq) first
- Dive into [Agora SDK Samples](https://github.com/AgoraIO) to see more tutorials
- Take a look at [Agora Use Case](https://github.com/AgoraIO-usecase) for more complicated real use case
- Repositories managed by developer communities can be found at [Agora Community](https://github.com/AgoraIO-Community)
- You can find full API documentation at [Document Center](https://docs.agora.io/en/)
- If you encounter problems during integration, you can ask question in [Stack Overflow](https://stackoverflow.com/questions/tagged/agora.io)
- You can file bugs about this sample at [issue](https://github.com/AgoraIO/Advanced-Video/issues)


## Licence
The MIT License (MIT).
